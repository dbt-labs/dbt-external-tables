version: 2

sources:
  - name: snowplow
    database: analytics
    schema: snowplow_external
    loader: S3
    loaded_at_field: collector_hour
  
    tables:
      - name: event
        external:
          location: "@raw.snowplow.snowplow"
          file_format: "( type = json )"
          auto_refresh: true
          partitions:
            - name: collector_hour
              data_type: timestamp
              expression: to_timestamp(substr(metadata$filename, 8, 13), 'YYYY/MM/DD/HH24')
        columns:
          - name: app_id
            data_type: varchar(255)
            description: "Application ID"
          - name: platform
            data_type: varchar(255)
            description: "Platform"
          - name: etl_tstamp
            data_type: timestamp
            description: "Timestamp event began ETL"
          - name: collector_tstamp
            data_type: timestamp
            description: "Time stamp for the event recorded by the collector"
          - name: dvce_created_tstamp
            data_type: timestamp
            description: "Timestamp event was recorded on the client device"
          - name: event
            data_type: varchar(128)
            description: "The type of event recorded"
          - name: event_id
            data_type: char(36)
            description: "A UUID for each event"
          - name: txn_id
            data_type: int
            description: "Transaction ID set client-side, used to de-dupe records"
          - name: name_tracker
            data_type: varchar(128)
            description: "Tracker namespace"
          - name: v_tracker
            data_type: varchar(100)
            description: "Tracker version"
          - name: v_collector
            data_type: varchar(100)
            description: "Collector version"
          - name: v_etl
            data_type: varchar(100)
            description: "ETL version"
          - name: user_id
            data_type: varchar(255)
            description: "Unique ID set by business"
          - name: user_ipaddress
            data_type: varchar(45)
            description: "User IP address"
          - name: user_fingerprint
            data_type: varchar(50)
            description: "A user fingerprint generated by looking at the individual browser features"
          - name: domain_userid
            data_type: varchar(36)
            description: "User ID set by Snowplow using 1st party cookie"
          - name: domain_sessionidx
            data_type: int
            description: "A visit / session index"
          - name: network_userid
            data_type: varchar(38)
            description: "User ID set by Snowplow using 3rd party cookie"
          - name: geo_country
            data_type: char(2)
            description: "ISO 3166-1 code for the country the visitor is located in"
          - name: geo_region
            data_type: char(2)
            description: "ISO-3166-2 code for country region the visitor is in"
          - name: geo_city
            data_type: varchar(75)
            description: "City the visitor is in"
          - name: geo_zipcode
            data_type: varchar(15)
            description: "Postcode the visitor is in"
          - name: geo_latitude
            data_type: double precision
            description: "Visitor location latitude"
          - name: geo_longitude
            data_type: double precision
            description: "Visitor location longitude"
          - name: geo_region_name
            data_type: varchar(100)
            description: "Visitor region name"
          - name: ip_isp
            data_type: varchar(100)
            description: "Visitor's ISP"
          - name: ip_organization
            data_type: varchar(100)
            description: "Organization associated with the visitor's IP address - defaults to ISP name if none is found"
          - name: ip_domain
            data_type: varchar(100)
            description: "Second level domain name associated with the visitor's IP address"
          - name: ip_netspeed
            data_type: varchar(100)
            description: "Visitor's connection type"
          - name: page_url
            data_type: varchar(4096)
            description: "The page URL"
          - name: page_title
            data_type: varchar(2000)
            description: "Web page title"
          - name: page_referrer
            data_type: varchar(4096)
            description: "URL of the referrer"
          - name: page_urlscheme
            data_type: varchar(16)
            description: "Scheme aka protocol"
          - name: page_urlhost
            data_type: varchar(255)
            description: "Host aka domain"
          - name: page_urlport
            data_type: int
            description: "Port if specified, 80 if not"
          - name: page_urlpath
            data_type: varchar(3000)
            description: "Path to page"
          - name: page_urlquery
            data_type: varchar(6000)
            description: "Querystring"
          - name: page_urlfragment
            data_type: varchar(3000)
            description: "Fragment aka anchor"
          - name: refr_urlscheme
            data_type: varchar(16)
            description: "Referer scheme"
          - name: refr_urlhost
            data_type: varchar(255)
            description: "Referer host"
          - name: refr_urlport
            data_type: int
            description: "Referer port"
          - name: refr_urlpath
            data_type: varchar(6000)
            description: "Referer page path"
          - name: refr_urlquery
            data_type: varchar(6000)
            description: "Referer URL querystring"
          - name: refr_urlfragment
            data_type: varchar(3000)
            description: "Referer URL fragment"
          - name: refr_medium
            data_type: varchar(25)
            description: "Type of referer"
          - name: refr_source
            data_type: varchar(50)
            description: "Name of referer if recognised"
          - name: refr_term
            data_type: varchar(255)
            description: "Keywords if source is a search engine"
          - name: mkt_medium
            data_type: varchar(255)
            description: "Type of traffic source"
          - name: mkt_source
            data_type: varchar(255)
            description: "The company / website where the traffic came from"
          - name: mkt_term
            data_type: varchar(255)
            description: "Any keywords associated with the referrer"
          - name: mkt_content
            data_type: varchar(500)
            description: "The content of the ad. (Or an ID so that it can be looked up.)"
          - name: mkt_campaign
            data_type: varchar(255)
            description: "The campaign ID"
          - name: contexts
            data_type: variant
            description: "Contexts attached to event by Tracker"
          - name: se_category
            data_type: varchar(1000)
            description: "Category of event"
          - name: se_action
            data_type: varchar(1000)
            description: "Action performed / event name"
          - name: se_label
            data_type: varchar(1000)
            description: "The object of the action e.g. the ID of the video played or SKU of the product added-to-basket"
          - name: se_property
            data_type: varchar(1000)
            description: "A property associated with the object of the action"
          - name: se_value
            data_type: double precision
            description: "A value associated with the event / action e.g. the value of goods added-to-basket"
          - name: unstruct_event
            data_type: variant
            description: ""
          - name: tr_orderid
            data_type: varchar(255)
            description: "Order ID"
          - name: tr_affiliation
            data_type: varchar(255)
            description: "Transaction affiliation (e.g. store where sale took place)"
          - name: tr_total
            data_type: dec(18,2)
            description: "Total transaction value"
          - name: tr_tax
            data_type: dec(18,2)
            description: "Total tax included in transaction value"
          - name: tr_shipping
            data_type: dec(18,2)
            description: "Delivery cost charged"
          - name: tr_city
            data_type: varchar(255)
            description: "Delivery address, city"
          - name: tr_state
            data_type: varchar(255)
            description: "Delivery address, state"
          - name: tr_country
            data_type: varchar(255)
            description: "Delivery address, country"
          - name: ti_orderid
            data_type: varchar(255)
            description: "Order ID"
          - name: ti_sku
            data_type: varchar(255)
            description: "Product SKU"
          - name: ti_name
            data_type: varchar(255)
            description: "Product name"
          - name: ti_category
            data_type: varchar(255)
            description: "Product category"
          - name: ti_price
            data_type: dec(18,2)
            description: "Product unit price"
          - name: ti_quantity
            data_type: int
            description: "Number of product in transaction"
          - name: pp_xoffset_min
            data_type: int
            description: "Minimum page x offset seen in the last ping period"
          - name: pp_xoffset_max
            data_type: int
            description: "Maximum page x offset seen in the last ping period"
          - name: pp_yoffset_min
            data_type: int
            description: "Minimum page y offset seen in the last ping period"
          - name: pp_yoffset_max
            data_type: int
            description: "Maximum page y offset seen in the last ping period"
          - name: useragent
            data_type: varchar(1000)
            description: "Raw useragent"
          - name: br_name
            data_type: varchar(50)
            description: "Browser name"
          - name: br_family
            data_type: varchar(50)
            description: "Browser family"
          - name: br_version
            data_type: varchar(50)
            description: "Browser version"
          - name: br_type
            data_type: varchar(50)
            description: "Browser type"
          - name: br_renderengine
            data_type: varchar(50)
            description: "Browser rendering engine"
          - name: br_lang
            data_type: varchar(255)
            description: "Language the browser is set to"
          - name: br_features_pdf
            data_type: boolean
            description: "Whether the browser recognizes PDFs"
          - name: br_features_flash
            data_type: boolean
            description: "Whether Flash is installed"
          - name: br_features_java
            data_type: boolean
            description: "Whether Java is installed"
          - name: br_features_director
            data_type: boolean
            description: "Whether Adobe Shockwave is installed"
          - name: br_features_quicktime
            data_type: boolean
            description: "Whether QuickTime is installed"
          - name: br_features_realplayer
            data_type: boolean
            description: "Whether RealPlayer is installed"
          - name: br_features_windowsmedia
            data_type: boolean
            description: "Whether mplayer2 is installed"
          - name: br_features_gears
            data_type: boolean
            description: "Whether Google Gears is installed"
          - name: br_features_silverlight
            data_type: boolean
            description: "Whether Microsoft Silverlight is installed"
          - name: br_cookies
            data_type: boolean
            description: "Whether cookies are enabled"
          - name: br_colordepth
            data_type: varchar(12)
            description: "Bit depth of the browser color palette"
          - name: br_viewwidth
            data_type: int
            description: "Viewport width"
          - name: br_viewheight
            data_type: int
            description: "Viewport height"
          - name: os_name
            data_type: varchar(50)
            description: "Name of operating system"
          - name: os_family
            data_type: varchar(50)
            description: "Operating system family"
          - name: os_manufacturer
            data_type: varchar(50)
            description: "Company responsible for OS"
          - name: os_timezone
            data_type: varchar(255)
            description: "Client operating system timezone"
          - name: dvce_type
            data_type: varchar(50)
            description: "Type of device"
          - name: dvce_ismobile
            data_type: boolean
            description: "Is the device mobile?"
          - name: dvce_screenwidth
            data_type: int
            description: "Screen width in pixels"
          - name: dvce_screenheight
            data_type: int
            description: "Screen height in pixels"
          - name: doc_charset
            data_type: varchar(128)
            description: "The pageâ€™s character encoding"
          - name: doc_width
            data_type: int
            description: "The page's width in pixels"
          - name: doc_height
            data_type: int
            description: "The page's height in pixels"
          - name: tr_currency
            data_type: varchar(3)
            description: "Currency"
          - name: tr_total_base
            data_type: dec(18,2)
            description: "Total in base currency"
          - name: tr_tax_base
            data_type: dec(18,2)
            description: "Total tax in base currency"
          - name: tr_shipping_base
            data_type: dec(18,2)
            description: "Delivery cost in base currency"
          - name: ti_currency
            data_type: varchar(3)
            description: "Currency"
          - name: ti_price_base
            data_type: dec(18,2)
            description: "Price in base currency"
          - name: base_currency
            data_type: varchar(3)
            description: "Reporting currency"
          - name: geo_timezone
            data_type: varchar(64)
            description: "Visitor timezone name"
          - name: mkt_clickid
            data_type: varchar(128)
            description: "The click ID"
          - name: mkt_network
            data_type: varchar(64)
            description: "The ad network to which the click ID belongs"
          - name: etl_tags
            data_type: varchar(500)
            description: "JSON of tags for this ETL run"
          - name: dvce_sent_tstamp
            data_type: timestamp
            description: "When the event was sent by the client device"
          - name: refr_domain_userid
            data_type: varchar(36)
            description: "The Snowplow domain_userid of the referring website"
          - name: refr_dvce_tstamp
            data_type: timestamp
            description: "The time of attaching the domain_userid to the inbound link"
          - name: derived_contexts
            data_type: variant
            description: ""
          - name: domain_sessionid
            data_type: char(36)
            description: "A visit / session identifier"
          - name: derived_tstamp
            data_type: timestamp
            description: "Timestamp making allowance for innaccurate device clock"
          - name: event_vendor
            data_type: varchar(1000)
            description: "Who defined the event"
          - name: event_name
            data_type: varchar(1000)
            description: "Event name"
          - name: event_format
            data_type: varchar(128)
            description: "Format for event"
          - name: event_version
            data_type: varchar(128)
            description: "Version of event schema"
          - name: event_fingerprint
            data_type: varchar(128)
            description: "Hash client-set event fields"
          - name: true_tstamp
            data_type: timestamp
            description: "User-set true timestamp for the event"
